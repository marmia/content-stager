* Decisions

決定事項（ADR簡易ログ）。日付はローカル時間基準。

** 2026-01-31: MVPの入力はURLのみ

- 入力対象: リンク（URL）だけ
- URLのドメイン制限: なし

** 2026-01-31: 本文取得は既存Skillの実装（agent-browser）を流用

- 既存Skills:
  - agent-browser-article（agent-browser CLI）
  - web-reader-article（MCP web-reader）
- MVPでは agent-browser（CLI）による取得を採用する
- 将来的に、両方を選択可能にする（プロバイダ切替）

** 2026-01-31: S1→S2更新は手動実行

- 本文取得/構造化は、ユーザーが実行したタイミングで随時行う
- 自動スケジューリング（cron/queue等）はMVPでは採用しない

** 2026-01-31: ストレージはSQLite

- MVPの永続化ストレージはSQLiteを採用する
- 既定のDBパスは `~/.local/share/content-stager/content-stager.sqlite3` とする（必要に応じて指定可能）
- `~/.local/share/content-stager/` が存在しない場合は自動作成する

** 2026-01-31: 本文の「不完全さ」はTopic抽出可否で吸収

- fetch段階で partial のような強い分類を前提にしない
- 取得した本文は可能な限りTopic分解を試みる
- 本文が不完全で意味をなさない場合はTopicを抽出せず処理を終了し、S1に留めて再実行可能にする

** 2026-01-31: 同一URLの再取得は「別Content」として追加する

- 運用上、同じURLを再度取り込みたいケース（例: 製品Changelog）があり得る
- そのためURLの一意制約は設けず、同一URLでもCaptureのたびに新しいContentとして保存する
- 同一URLのContent同士を「同じもの」とみなすかどうか（グルーピング/差分/集約）は後段の処理として扱う

** 2026-01-31: 抽出した本文テキスト（article_text）を保存する

- MVPでは、URLから抽出した本文テキストのスナップショットを永続化する
- 目的:
  - 取得不能/リンク切れになっても再現可能性を確保する
  - 後段のTopic再生成やデバッグを可能にする
- 保存形式（圧縮/上限など）は別途検討する（open-questions.org参照）

** 2026-01-31: Skill名は ingest_url

- URL取り込み〜Topic抽出〜保存までを一括で行う手動Skillは `ingest_url` とする
- 実行形態はCLI（対話式プロンプトなし）とする

** 2026-01-31: MVPのUIはCLI（ingest_url）

- MVPはまず `ingest_url` をUI/操作面の中心として整備する

** 2026-01-31: MVPで list_shelves を用意する

- S2の観測窓として `list_shelves` を用意する（host棚、本文は一覧しない）

** 2026-01-31: MVPのSkill出力は人間向けテキストのみ

- MVP段階では、Skillの標準出力は人間が読む前提のテキストとする
- 機械可読なJSON出力は将来の検討事項とする
- 将来の一括処理を見据え、1 URL = 1行で結果を出す
- 表示項目: タイトル（長すぎる場合は本文先頭から短縮）、取り込み結果（OK/NG）、URL

** 2026-01-31: タイトル短縮の閾値は40文字

- `page_title` が40文字を超える場合は「長すぎる」とみなし短縮表示する

** 2026-01-31: `contents` に `is_*` を保持する

- Issue判定（`is_*`）は `contents` テーブルに保持する（最新状態として扱う）
- 理由:
  - Content単位の「扱いづらさ」（重複/文脈欠落/リンク切れ）を入口で把握できると運用が楽なため
 - MVPでは `is_context_missing` は「空のみ」を true とし、「空ではないが無効」は扱わない（signals-and-issues.org参照）

** 2026-01-31: `topics` に `has_signal_*` を保持する（方針変更）

- 強シグナル候補（`has_signal_*`）は `topics` テーブルに保持する
- 理由:
  - ユーザーの関心単位はContent全体ではなくTopicであることが多いため
- 備考:
  - `contents` 側の「強シグナル候補あり」は `topics` から集計して導出できる

** 2026-01-31: MVPでは強シグナルの「成立」を扱わない

- MVPでは `has_signal_*` は候補フラグとして保存するだけに留める
- ユーザー承認/文脈一致による「成立」やTask化はMVPの対象外とする

補足:
- ここで「扱わない」とは「成立/Task化をしない」という意味であり、
  候補フラグ（`topics.has_signal_*`）の検出・保存はMVPから行う。

** 2026-01-31: 強シグナル検出の語彙リストはMVPで定義しない

- MVPでは、強シグナル検出のための固定語彙（seed vocabulary）をドキュメントとして整備しない
- 実装はLLMの指示（プロンプト）による候補判定を基本とする（揺れは許容し、状態遷移のトリガーにしない）

** 2026-01-31: 複数URLの入力はファイルで渡す

- 複数URLを一括処理する場合は、1行1URLのファイルを渡す

** 2026-01-31: Topic抽出はコーディングエージェントが実施

- Topic抽出は、MVPではコーディングエージェント（Codex）が実施する想定とする
- 実装方式（OpenAI API直叩き等）は別途ドキュメントで確定する（unverified）

** 2026-01-31: Agent Skillsは他のAgent Skillsを直接呼び出せない

- そのため、本文取得は `agent-browser-article` Skill を呼び出すのではなく、
  同等のスクリプトを `ingest_url` に内包して実行する

** 2026-01-31: 意図ラベルはTopicに付与する

- 意図ラベルはContent全体ではなく、Topicに対して付与する
- 理由:
  - ユーザーの関心はContentの一部分（論点）に向きやすい
- 影響:
  - Capture時点での意図ラベル入力は必須としない（Topic抽出後に付与する）
