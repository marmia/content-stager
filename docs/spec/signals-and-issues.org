* Signals & Issues（MVP）

このドキュメントは、`topics.has_signal_*` / `contents.is_*` の意味と付与方針を定義する。
重要: ここでの検出は「価値判断」ではなく「注意が必要かもしれない兆候の抽出」であり、状態遷移のトリガーにしない。

** 用語

- Signal（強シグナル）:
  - 行動（外部タスク化）候補になりやすい「危険信号」。
  - ただし検出時点では“成立”ではなく“候補”の可能性がある（特に期限以外）。
- Issue（形式破綻/問題）:
  - 重複/文脈欠落/リンク切れなど、内容以前の“扱いづらさ”を示す。

** 強シグナル（has_signal_*）

*** 共通原則（MVP）

- `topics.has_signal_*` は **候補フラグ** として扱う。
  - `has_signal_* = 1` は「強シグナルが確定」ではない（特に依存/不可逆/安全）。
- MVPでは「成立」（ユーザー承認/文脈一致）は扱わない（decisions.org参照）。
- `has_signal_*` は S2→S5（Task）を自動で引き起こさない。
- 期限以外の強シグナルは、コンテンツ単体では確定しにくく、ユーザー文脈との一致で“成立”する（work/memo.orgの整理に基づく）。

*** 検出仕様（MVP）

- 強シグナル候補の検出は、MVPでは「固定語彙リスト」を定義せず、LLMの指示（プロンプト）で候補判定する（decisions.org参照）。
- 判定はbest-effortであり、偽陽性/偽陰性を許容する（状態遷移のトリガーにしないため）。

*** 期限（has_signal_deadline）

- 意味: 明示された日付/締切/終了条件が含まれる兆候。
- 例: リリース日、サポート終了日（EOL）、移行期限、API停止日、証明書期限。
- 特性:
  - 4つの中で比較的「コンテンツ単体」で成立しやすい。

*** 依存（has_signal_dependency）

- 意味: 前提条件・順序・ブロッカー構造が含まれる兆候。
- 例: 「〜の前に」「〜が決まらないと」「前提として」「互換性要件」。
- 注意:
  - “自分の状況で本当に依存か”は文脈次第なので、候補として扱う。

*** 不可逆（has_signal_irreversible）

- 意味: 時間経過で「同じ条件で判断できなくなる」兆候。
  - 単なる“期限”とは違い、「後から調べられるが判断材料の質が変わる」タイプ。
- 例: 初期/最初期/ベータ初期/限定の“観測条件”、初期UX、初期コミュニティの空気、初期の危うさ。
- 注意:
  - “自分にとって観測が必要か”は文脈次第なので、候補として扱う。

*** 安全（has_signal_safety）

- 意味: セキュリティ/安全性/法務的にリスクがあり得る兆候。
- 例: 管理者権限、フルアクセス、常駐、データ送信、追跡、未監査、CVE。
- 注意:
  - “自分が使う可能性があるか”と“許容リスク”で成立が変わるため、候補として扱う。

** Issue（is_*）

*** 完全重複（is_full_duplicate）

- 意味: 過去に取り込んだ同一URLのContentと「本文が同一」である可能性が高い（=同じスナップショット）。
- MVP判定（案）:
  - `fetch_runs.status='ok'` で `article_sha256` が得られていること
  - 同一URLの過去Contentに対して、同じ `article_sha256` を持つ `fetch_runs` が存在すること
  - 上記を満たす場合に `contents.is_full_duplicate=1` とする
- 補足:
  - これは「同じURLかつ本文同一」を示すだけであり、価値判断ではない
  - Diffを取って差分のみ保存する設計は将来検討（open-questions.org参照）

*** 文脈欠落（is_context_missing）

- 意味: 本文が空であり、Topic抽出以前に扱えない状態。
- MVP判定:
  - `fetch_runs.status='ok'` かつ `article_text` が空（トリミング後も空）の場合に `contents.is_context_missing=1` とする
- 備考:
  - Xの短い投稿なども対象にするため、MVPでは文字数閾値を設けない
  - 「空ではないがローディング文言/導線しかない」等は将来拡張で扱う（open-questions.org参照）

*** リンク切れ（is_dead_link）

- 意味: 取得時点でアクセス不能/本文取得不能等の兆候（dead link “候補”）。
- MVP判定（案）:
  - `fetch_runs.status='failed'` の場合は `contents.is_dead_link=1` としてよい（ただし一時障害の可能性は残る）
  - 追加でHTTPステータスが取得できる場合は、`>=400` を根拠として `is_dead_link=1` にしてよい
- 注意:
  - 一時的障害の可能性があるため、確定ではなく“最新判定”として扱う（decisions.org参照）。
  - agent-browser経由の取得ではHTTPステータスが取れないケースがあり得る（その場合はfetch失敗を根拠にする）

** 実装上の保存方針（MVP）

- `contents.is_*` は `contents` に保持し、再実行で上書きされる（decisions.org参照）。
- `topics.has_signal_*` は `topics` に保持し、再実行で上書きされる（decisions.org参照）。
- 理由:
  - MVPでは「履歴」より「最新状態の把握」を優先する。
- 将来:
  - 判定の履歴が必要になったら `detect_runs` のような履歴テーブルを追加する。
